# 10 — Безопасность, лимиты, защита от повторов

Цель
- Защитить процессы создания `sid`, подтверждения и выдачи токенов от злоупотреблений.

Требования
- Webhook: проверка `X-Telegram-Bot-Api-Secret-Token` и источника (опц.).
- Rate limit: на `POST /auth/telegram/session` (IP/session) и на webhook (по `telegram_id`/`sid`).
- `sid` одноразовый: состояния `pending → ready → used`.
- TTL `sid` ~5 минут; окно для повторной доставки апдейтов Telegram.
- Логи и аудит (см. 11‑й шаг).

Приёмочные критерии
- При превышении лимитов — 429.
- Повторная доставка апдейта не меняет готовую запись.

Тест‑идеи
- Бёрст запросов на создание сессий.
- Повторные webhook‑апдейты.

