# 05 — JWT/refresh и серверные сессии

Цель
- Выпуск минимального access‑JWT и refresh‑cookie. Поддержка серверных сессий в Redis и блок‑листа `blk:{jti}`.

Требования
- access‑JWT: поля `sub`, `jti`, `iat`, `exp`; подпись RS256/ES256.
- Redis: `sess:{jti}` — состояние (userId, activeFamilyId, scopes, capVersion, exp), TTL ≈ `accessTTL + δ`.
- Блок‑лист `blk:{jti}` — при ротации/выходе до истечения.
- Извлечение прав/`scopes` по активной семье.

Приёмочные критерии
- Валидный JWT проверяется и соотносится с `sess:{jti}`.
- При отсутствии `sess:{jti}` (кроме резервного кейса) — отказ.

Тест‑идеи
- Формирование access/refresh, проверка подписи и сроков.
- Сохранение `sess:{jti}` и чтение при запросе.
- Блокировка по `blk:{jti}`.

