# 02 — Создание семьи владельца при первом входе

Цель
- Когда `User` приходит без `invitationId`, создать базовую семью и связать её с пользователем.

Требования
- Liquibase: таблицы `families` и `family_members` (если ещё нет) либо расширение существующих схем.
- `FamilyService.createForOwner(user: User)`:
  - генерирует `familyId` и запись в таблице `families` (`ownerId = user.id`, `name = user.name` по умолчанию);
  - создаёт `Member` с ролью `owner` и статусом `active`.
- Установка `preferredFamilyId` у пользователя, если оно `null`.
- Возвращать структуру `{ family, member }` для дальнейшей сборки `AuthResponse` и капабилити.
- Гарантировать идемпотентность: повторный вызов при том же `User` не создаёт дубликатов (используем транзакцию + проверку наличия семьи владельца).

Интеграция
- В шаге подтверждения Telegram — после 01 вызываем `FamilyService.createForOwner`, если `invitationId` пуст.
- Обновляем `sess:{jti}`/`AuthResponse` активной семьёй (`preferredFamilyId`).

Приёмочные критерии
- Новый пользователь получает семью с ролью `owner`.
- Повторная авторизация не плодит новые семьи.
- `preferredFamilyId` заполнен в `users`.

Тест‑идеи
- Unit `FamilyService`: happy-path создания семьи + участника.
- Тест идемпотентности: повторный вызов → возвращает ранее созданную семью.
- Интеграционный тест `application`: подтверждение Telegram без инвайта → response содержит `familyId` владельца.
