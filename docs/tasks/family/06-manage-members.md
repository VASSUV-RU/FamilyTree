# 06 — Управление составом семьи (инвайты, роли, удаления)

Цель
- Реализовать CRUD над членами семьи: приглашение, изменение ролей, уход/исключение.

Требования
- API методы:
  - `POST /families/{id}/invites` — создание инвайта (роль, personId?);
  - `GET /families/{id}/members` — список активных членов;
  - `PATCH /families/{id}/members/{memberId}` — изменение роли/привязки;
  - `DELETE /families/{id}/members/{memberId}` — удаление/бан (отмечать `status = removed`).
- Инвайты: хранить в таблице `family_invites` с TTL, кодом, ролью и опциональным `personId`.
- При выходе участника обновлять `preferredFamilyId`, если он покидает активную семью (перевыбор семьи или `null`).
- Ограничения прав: `owner` может всё; `admin` — все кроме удаления владельца; участники → только `DELETE` себя.
- Логи безопасности: каждая операция логируется в аудит (см. 08).

Приёмочные критерии
- Владельцы/админы могут выдавать инвайты и управлять ролями.
- Нельзя удалить последнего владельца семьи.
- Удалённый участник теряет доступ (обновление сессий через 08).

Тест‑идеи
- Контроллерные тесты для каждого эндпоинта (WebMvcTest).
- Сервисные тесты: бизнес-правила ролей, запрет удаления владельца.
- Интеграционный сценарий: участник удаляет себя → preferredFamily очищается.
