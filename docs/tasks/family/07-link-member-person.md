# 07 — Связь Member ↔ Person и синхронизация дерева

Цель
- Обеспечить связь аккаунтов с узлами дерева (`Person`), чтобы разрешения зависели от структуры семьи.

Требования
- Расширить `Member` полями `personId`, `relation`, `isPrimary`.
- Сервис `MemberLinkService`:
  - связывает участника с существующим `Person` (валидирует принадлежность семье);
  - при необходимости создаёт нового `Person` (todo: вызвать сервис персон, когда появится).
- Поддержать сценарий auto-линка при принятии инвайта (если передан `personId`).
- Обновлять `capVersion` при изменении связей, т.к. права могут зависеть от роли в дереве.
- Документация: уточнить как `Member` отображается в UI/боте.

Приёмочные критерии
- Можно связать участника с `Person` своей семьи и получить связь в ответах API.
- Попытка связать с чужим `Person` → `forbidden`/`notFound`.
- При создании новой семьи создаётся первичный `Person` для владельца (todo).

Тест‑идеи
- Unit `MemberLinkService`: happy-path, ошибка принадлежности.
- Интеграционный тест с БД: связь сохраняется и читается в `GET /families/{id}/members`.
- Тест on-boarding: инвайт с `personId` → участник автоматически связан.
